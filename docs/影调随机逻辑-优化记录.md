## 目的
让「色阶&影调」的 9 个影调示例在每次刷新时：
- 仍严格遵守：暗/灰/亮（整体基调） + 短/中/长（可用色阶范围）约束
- 同一影调内呈现“合理的随机变化”（像不同封面版本），而不是每次都长得一样
- 全局尽量避免视觉“融合”（相邻元素同色或过近导致看不清层次）

## 约束（不变）
- 暗度：整体大面积以低亮度组为主（0–3）
- 灰度：整体大面积以中间亮度组为主（4–6）
- 亮度：整体大面积以高亮度组为主（7–10）
- 短调：仅使用连续 3 档色阶
- 中调：仅使用连续 5 档色阶
- 长调：允许使用全部 11 档色阶（0–10）

## 已实施的优化（按重要性）
### 1) “相邻防融合”从“全对全”升级为“空间邻接优先”
问题：仅用“颜色之间的亮度差/面积权重”做全对全惩罚，会出现：
- 不相邻的元素被过度约束，随机空间变小，容易收敛到同一解
- 真正相邻的元素仍可能“贴一起融掉”（尤其在短/中调范围窄时）

优化：根据 SVG 元素的近似 bbox（包围盒）推断“可能相邻”的颜色对：
- 对“空间上可能相邻”的颜色对：同档/相邻档惩罚更强
- 对“不太可能相邻”的颜色对：惩罚降低，释放随机空间

效果：更符合“视觉可读性优先”的目标，全局减少融合。

### 2) 长调的“对比落点”改为“互斥随机载体”
问题：长调虽然色阶多，但对比层次容易固定在某个位置（例如总是底部块或总是标题）。

优化：在“圆 / 两行标题 / 底部块”之间随机选择一个作为“对比载体”：
- 若圆承担了亮/暗对比，则标题/底部块不必再承担同样的对比（反之亦然）
- 形成你提出的“随机关系”：某处承担对比后，其它处自动让位

效果：同一影调刷新会出现更丰富的“结构变化”，且不破坏整体基调。

### 3) 短调加入“关键层偏好”，打破反复收敛到同一解
问题：短调只有 3 档色阶，优化器在强约束下很容易总是找到同一“最优分配”，导致灰短调/亮短调几乎不变。

优化：每次对关键层（圆/标题/底部块/剪影）随机抽 2–3 个做“偏好层”：
- 倾向让它们分别落到 start/mid/end 三档
- 鼓励同时用到两端（减少“整张都挤在一档”的平）

效果：短调仍保持“低对比/窄范围”的学习特征，但刷新能明显看到变化。

### 4) 期望覆盖档位数（展示丰富度）
问题：中/长调在满足整体基调的前提下，仍可能“用到的档位太少”，视觉上偏平。

优化：对不同调长设置“期望使用的唯一档位数”的软目标：
- 达不到时扣分，鼓励更丰富的层次分布
- 仍以不融合、整体基调正确为更高优先级

## 验收方式（人工）
- 随机刷新同一影调卡片 10 次：应能看到结构/层次变化（尤其短调、中调）
- 观察相邻形状边界：不应频繁出现同档融合（尤其标题与背景、圆与剪影、底部条之间）
- 亮长调：大面积应“亮”为主，小面积允许暗/灰点缀；暗长调反之

## 代码位置
- 随机/评分主逻辑：`src/projects/color-models/topics/levels-tones/topic.js`
- 关键函数：`computeWeightedColorMap()`、`scoreAssignment()`、`splitTemplateLayerColors()`
